<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SolarMetrics - Dashboard de Energia</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #ECFF49;
            --dark: #343333;
            --bg-dark: #1a1a1a;
            --bg-card: #242424;
            --border: #3a3a3a;
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--dark) 0%, var(--bg-dark) 100%);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Header */
        header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 40px;
            padding: 20px;
            background: rgba(52, 51, 51, 0.5);
            border: 1px solid var(--border);
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo {
            width: 50px;
            height: 50px;
            background: var(--primary);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: var(--dark);
            font-size: 24px;
        }

        .logo-text h1 {
            font-size: 24px;
            color: var(--primary);
            margin: 0;
        }

        .logo-text p {
            color: var(--text-secondary);
            font-size: 12px;
            margin: 4px 0 0 0;
        }

        .status-info {
            display: flex;
            gap: 30px;
            align-items: center;
        }

        .status-item {
            text-align: right;
        }

        .status-item p {
            color: var(--text-secondary);
            font-size: 12px;
            margin: 0;
        }

        .status-value {
            font-size: 20px;
            font-weight: bold;
            color: var(--primary);
            margin-top: 4px;
        }

        .online-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: #4ade80;
        }

        .online-dot {
            width: 10px;
            height: 10px;
            background: #4ade80;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Main Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: rgba(36, 36, 36, 0.8);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .card:hover {
            border-color: var(--primary);
            box-shadow: 0 0 20px rgba(236, 255, 73, 0.1);
        }

        .card-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-title::before {
            content: '';
            width: 4px;
            height: 20px;
            background: var(--primary);
            border-radius: 2px;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-bottom: 20px;
        }

        /* Stats Cards */
        .stats-grid {
            grid-column: 1 / -1;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .stat-card {
            background: rgba(36, 36, 36, 0.8);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 8px;
        }

        .stat-unit {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .stat-bar {
            width: 100%;
            height: 6px;
            background: var(--border);
            border-radius: 3px;
            margin-top: 12px;
            overflow: hidden;
        }

        .stat-progress {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), #d4ff1f);
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        /* Real-time Graph */
        .full-width {
            grid-column: 1 / -1;
        }

        .chart-wrapper {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        /* Footer */
        footer {
            text-align: center;
            color: var(--text-secondary);
            font-size: 12px;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
        }

        /* Responsivo */
        @media (max-width: 1024px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .chart-wrapper {
                grid-template-columns: 1fr;
            }

            header {
                flex-direction: column;
                text-align: center;
            }

            .status-info {
                justify-content: center;
                margin-top: 15px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Loading state */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 300px;
            color: var(--text-secondary);
        }

        .error {
            color: #ff6b6b;
            background: rgba(255, 107, 107, 0.1);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #ff6b6b;
            margin-bottom: 15px;
        }

        .success {
            color: #4ade80;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <div class="logo-section">
                <div class="logo"><svg width="31" height="31" viewBox="0 0 31 31" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M29.2045 8.33367C27.5017 5.12985 24.7512 2.60938 21.4137 1.19454C18.0789 -0.196534 14.3638 -0.378635 10.9092 0.679636C7.45462 1.73791 4.47707 3.97021 2.49002 6.99158C0.555105 9.98474 -0.292487 13.5535 0.0895718 17.0985C0.482817 20.5927 2.08595 23.8386 4.62046 26.2722C4.94974 26.602 5.39756 26.658 5.6083 26.4305C5.81904 26.203 5.73343 25.771 5.43378 25.4742L5.33829 25.3918C3.21021 23.0644 1.9416 20.0778 1.74332 16.9283C1.54504 13.7789 2.42904 10.6564 4.24837 8.07976C6.03015 5.56829 8.61501 3.74155 11.575 2.902C14.5349 2.06246 17.6924 2.26046 20.5247 3.46323C23.3394 4.67662 25.6566 6.81526 27.0934 9.52583C28.5303 12.2364 29.0009 15.3567 28.4274 18.3713C27.8592 21.3061 26.3446 23.9729 24.1162 25.962C21.8878 27.9511 19.0689 29.1526 16.0926 29.3818L15.9246 23.3209C15.9203 23.1686 15.8832 23.019 15.816 22.8824L16.0695 22.8626C16.2572 22.8626 16.3988 22.6021 16.3988 22.2954C16.3988 21.9887 16.2539 21.7381 16.0695 21.7282H16.0168L14.4396 21.6161C13.9791 21.5925 13.5244 21.5026 13.0895 21.349C12.2539 21.051 11.5236 20.5145 10.9887 19.8058C10.4772 19.1185 10.1763 18.297 10.1227 17.4414C10.1227 17.0688 10.1392 16.4819 10.1524 15.9674V15.5585C13.6296 15.6179 17.1067 15.6047 20.5839 15.519L20.6366 17.0292C20.6652 17.7516 20.5219 18.4705 20.2184 19.1265C19.8883 19.8124 19.3938 20.4059 18.7791 20.8541C18.1643 21.3023 17.4484 21.5913 16.6951 21.6952C16.5338 21.7249 16.4021 21.9854 16.3988 22.2954C16.3955 22.6054 16.5568 22.8527 16.7676 22.8626H16.8269C17.8356 22.8476 18.8238 22.575 19.6979 22.0707C20.572 21.5664 21.3032 20.8469 21.822 19.9805C22.3531 19.0786 22.6529 18.059 22.6946 17.0128L22.7835 14.3747C22.7915 14.0898 22.6865 13.8134 22.4916 13.6057C22.2966 13.3981 22.0275 13.2762 21.743 13.2668H21.6706C20.7552 13.2404 19.8365 13.2404 18.9211 13.2239C19.3914 11.4404 19.2618 9.55131 18.5523 7.84894C18.368 7.79241 18.1746 7.77225 17.9826 7.78958C17.7918 7.77243 17.5994 7.79259 17.4163 7.84894C16.7083 9.53969 16.5741 11.4164 17.0343 13.1909C15.9082 13.1909 14.782 13.1744 13.6559 13.1909C14.1129 11.4208 13.9799 9.54961 13.2772 7.86213C13.093 7.8056 12.8995 7.78544 12.7076 7.80277C12.5167 7.78562 12.3244 7.80578 12.1412 7.86213C11.4391 9.54986 11.3073 11.4212 11.7658 13.1909C10.8504 13.1909 9.93504 13.1909 9.01964 13.2173H8.96366C8.66292 13.2251 8.37754 13.352 8.17013 13.5702C7.96271 13.7884 7.8502 14.0801 7.85728 14.3813L7.91326 15.9707C7.93301 16.5082 7.92972 16.9831 7.99558 17.6657C8.15962 18.926 8.7055 20.1056 9.55966 21.0456C10.4002 21.9603 11.5016 22.5935 12.7142 22.8593C13.296 22.9834 13.8927 23.0223 14.4857 22.9747L14.8512 22.9483C14.8015 23.0655 14.7726 23.1905 14.7656 23.3176V23.4429L14.5812 30.2094C14.5763 30.3093 14.5914 30.4091 14.6255 30.503C14.6596 30.5969 14.7121 30.6831 14.7798 30.7565C14.8476 30.8299 14.9293 30.889 15.0201 30.9304C15.1109 30.9718 15.2091 30.9946 15.3089 30.9976H15.3418C18.8909 31.0608 22.3532 29.8961 25.1445 27.7C27.9737 25.4553 29.9287 22.2894 30.6703 18.7518C31.412 15.2143 30.8934 11.5283 29.2045 8.33367Z" fill="black"/>
                </svg>
                </div>
                <div class="logo-text">
                    <h1>SolarMetrics</h1>
                    <p>Monitor de Energia em Tempo Real</p>
                </div>
            </div>
            <div class="status-info">
                <div class="status-item">
                    <p>Consumo Atual</p>
                    <div class="status-value" id="currentConsumption">0 W</div>
                </div>
                <div class="status-item">
                    <p>Geração Atual</p>
                    <div class="status-value" id="currentGeneration">0 W</div>
                </div>
                <div class="online-indicator">
                    <div class="online-dot"></div>
                    <span>Sistema Online</span>
                </div>
            </div>
        </header>

        <!-- Dashboard Grid -->
        <div class="dashboard-grid">
            <!-- Gráfico de Consumo vs Geração -->
            <div class="card full-width">
                <div class="card-title">Consumo vs Geração de Energia</div>
                <div class="chart-wrapper">
                    <div class="chart-container">
                        <canvas id="realtimeChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <canvas id="comparisonChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Estatísticas -->
            <div class="stat-card">
                <div class="stat-label">Consumo Total</div>
                <div class="stat-value" id="totalConsumption">0</div>
                <div class="stat-unit">Watts</div>
                <div class="stat-bar">
                    <div class="stat-progress" id="consumptionProgress"></div>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-label">Geração Total</div>
                <div class="stat-value" id="totalGeneration">0</div>
                <div class="stat-unit">Watts</div>
                <div class="stat-bar">
                    <div class="stat-progress" id="generationProgress"></div>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-label">Eficiência</div>
                <div class="stat-value" id="efficiency">0</div>
                <div class="stat-unit">%</div>
                <div class="stat-bar">
                    <div class="stat-progress" id="efficiencyProgress"></div>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-label">Potência Líquida</div>
                <div class="stat-value" id="netPower">0</div>
                <div class="stat-unit">Watts</div>
                <div class="stat-bar">
                    <div class="stat-progress" id="netPowerProgress"></div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer>
            <p>© 2025 SolarMetrics. Dados atualizados em tempo real. Última atualização: <span id="lastUpdate">--:--:--</span></p>
        </footer>
    </div>

    <script>
        // Configuração da API - ALTERE AQUI PARA SUA API
        const API_URL = 'http://localhost:1880/info'; // Mude para sua URL
        const UPDATE_INTERVAL = 1000; // Atualiza a cada 5 segundos

        // Variáveis globais
        let realtimeChart;
        let comparisonChart;
        let chartData = {
            ConsumoWatt: [],
            GeracaoWatt: [],
            timestamps: []
        };

        // Inicialização
        document.addEventListener('DOMContentLoaded', () => {
            initCharts();
            fetchData();
            setInterval(fetchData, UPDATE_INTERVAL);
        });

        // Inicializa os gráficos
        function initCharts() {
            const ctxRealtime = document.getElementById('realtimeChart').getContext('2d');
            realtimeChart = new Chart(ctxRealtime, {
                type: 'line',
                data: {
                    labels: chartData.timestamps,
                    datasets: [
                        {
                            label: 'Consumo (W)',
                            data: chartData.ConsumoWatt,
                            borderColor: '#ff6b6b',
                            backgroundColor: 'rgba(255, 107, 107, 0.1)',
                            tension: 0.4,
                            fill: true,
                            pointRadius: 4,
                            pointBackgroundColor: '#ff6b6b',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2
                        },
                        {
                            label: 'Geração (W)',
                            data: chartData.GeracaoWatt,
                            borderColor: '#ECFF49',
                            backgroundColor: 'rgba(236, 255, 73, 0.1)',
                            tension: 0.4,
                            fill: true,
                            pointRadius: 4,
                            pointBackgroundColor: '#ECFF49',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#b0b0b0',
                                usePointStyle: true,
                                padding: 20
                            }
                        }
                    },
                    scales: {
                        y: {
                            ticks: { color: '#b0b0b0' },
                            grid: { color: 'rgba(255,255,255,0.05)' }
                        },
                        x: {
                            ticks: { color: '#b0b0b0' },
                            grid: { color: 'rgba(255,255,255,0.05)' }
                        }
                    }
                }
            });

            const ctxComparison = document.getElementById('comparisonChart').getContext('2d');
            comparisonChart = new Chart(ctxComparison, {
                type: 'bar',
                data: {
                    labels: ['Consumo Total', 'Geração Total'],
                    datasets: [{
                        label: 'W',
                        data: [0, 0],
                        backgroundColor: ['#ff6b6b', '#ECFF49'],
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#b0b0b0' }
                        }
                    },
                    scales: {
                        y: {
                            ticks: { color: '#b0b0b0' },
                            grid: { color: 'rgba(255,255,255,0.05)' }
                        },
                        x: {
                            ticks: { color: '#b0b0b0' },
                            grid: { color: 'rgba(255,255,255,0.05)' }
                        }
                    }
                }
            });
        }

        // Busca dados da API
        async function fetchData() {
            try {
                const response = await fetch(API_URL);
                if (!response.ok) throw new Error('Erro ao buscar dados');
                
                const data = await response.json();
                
                // Adiciona dados ao gráfico (mantém os últimos 20 pontos)
                const now = new Date().toLocaleTimeString();
                chartData.ConsumoWatt.push(data.sensorinfo.ConsumoWatt);
                chartData.GeracaoWatt.push(data.sensorinfo.GeracaoWatt);
                chartData.timestamps.push(now);

                if (chartData.ConsumoWatt.length > 20) {
                    chartData.ConsumoWatt.shift();
                    chartData.GeracaoWatt.shift();
                    chartData.timestamps.shift();
                }

                // Atualiza valores no header
                document.getElementById('currentConsumption').textContent = 
                    (data.sensorinfo.ConsumoWatt).toFixed(2) + ' W';
                document.getElementById('currentGeneration').textContent = 
                    (data.sensorinfo.GeracaoWatt).toFixed(2) + ' W';

                // Calcula totais e atualiza stats
                updateStats(data);

                // Atualiza gráficos
                realtimeChart.data.labels = chartData.timestamps;
                realtimeChart.data.datasets[0].data = chartData.ConsumoWatt;
                realtimeChart.data.datasets[1].data = chartData.GeracaoWatt;
                realtimeChart.update('active');

                // Atualiza timestamp
                document.getElementById('lastUpdate').textContent = now;

            } catch (error) {
                console.error('Erro ao buscar dados:', error);
            }
        }

        // Atualiza estatísticas
        function updateStats(data) {
            const totalConsumption = (chartData.ConsumoWatt.reduce((a, b) => a + b, 0) * 5 / 60).toFixed(1);
            const totalGeneration = (chartData.GeracaoWatt.reduce((a, b) => a + b, 0) * 5 / 60).toFixed(1);
            const efficiency = data.GeracaoWatt > 0 ? ((1 - data.ConsumoWatt / data.GeracaoWatt) * 100) : 0;
            const netPower = (data.GeracaoWatt - data.ConsumoWatt).toFixed(2);

            document.getElementById('totalConsumption').textContent = totalConsumption;
            document.getElementById('totalGeneration').textContent = totalGeneration;
            document.getElementById('efficiency').textContent = efficiency.toFixed(1);
            document.getElementById('netPower').textContent = netPower;

            // Atualiza barras de progresso
            document.getElementById('consumptionProgress').style.width = 
                Math.min(100, (data.ConsumoWatt / 10 * 100)) + '%';
            document.getElementById('generationProgress').style.width = 
                Math.min(100, (data.GeracaoWatt / 10 * 100)) + '%';
            document.getElementById('efficiencyProgress').style.width = 
                Math.min(100, efficiency) + '%';
            document.getElementById('netPowerProgress').style.width = 
                Math.min(100, (Math.abs(netPower) / 10 * 100)) + '%';

            // Atualiza gráfico de comparação
            comparisonChart.data.datasets[0].data = [totalConsumption, totalGeneration];
            comparisonChart.update('none');
        }

        // Dados de teste (remova quando conectar a API real)
        window.addEventListener('load', () => {
            // Simula dados se a API não responder
            const simulateData = setInterval(() => {
                if (document.getElementById('currentConsumption').textContent === '0 W') {
                    const testData = {
                        ConsumoWatt: Math.random() * 5 + 1,
                        GeracaoWatt: Math.random() * 8 + 2
                    };
                    updateStats(testData);
                }
            }, 1000);
        });
    </script>
</body>
</html>